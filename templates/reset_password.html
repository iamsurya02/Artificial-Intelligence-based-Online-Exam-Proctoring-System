<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Reset Password</title>
    <link rel="stylesheet" href="../static/login_style.css">
</head>
<body>
    <div class="container">
        <div class="row">
            <div class="col align-items-center flex-col">
                <div class="form-wrapper align-items-center">
                    <div class="form sign-in">
                        <h2>Reset Your Password</h2>
                        <div class="input-group">
                            <i class='bx bxs-lock-alt'></i>
                            <input id="new-password" type="password" placeholder="New Password *">
                        </div>
                        <div class="input-group">
                            <i class='bx bxs-lock-alt'></i>
                            <input id="confirm-password" type="password" placeholder="Confirm Password *">
                        </div>
                        <button id="reset-btn">Reset Password</button>
                        <p><a href="/">Back to Login</a></p>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <script>
        const resetBtn = document.getElementById("reset-btn");
        const newPassword = document.getElementById("new-password");
        const confirmPassword = document.getElementById("confirm-password");

        resetBtn.addEventListener("click", function() {
            const password = newPassword.value;
            const confirm = confirmPassword.value;
            const token = new URLSearchParams(window.location.search).get('token');

            if (password.length < 8 || !/[!@#$%^&*]/.test(password)) {
                window.alert("Password must be at least 8 characters and include a special character.");
                return;
            }
            if (password !== confirm) {
                window.alert("Passwords do not match.");
                return;
            }

            fetch('http://127.0.0.1:5000/reset_password', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ token, password })
            })
            .then(res => res.json())
            .then(data => {
                if (data.success) {
                    window.alert("Password reset successfully! Please log in.");
                    window.location.href = '/';
                } else {
                    window.alert("Error: " + data.message);
                }
            })
            .catch(error => console.error('Reset error:', error));
        });
    </script>
</body>
</html>